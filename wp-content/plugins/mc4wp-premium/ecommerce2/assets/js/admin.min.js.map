{"version":3,"sources":["ecommerce2/assets/js/admin.js"],"names":["r","e","n","t","o","i","f","c","u","a","Error","code","p","exports","call","length","1","require","module","element","count","wrapper","bar","document","createElement","step_size","progress","done","style","height","width","border","lineHeight","boxSizing","backgroundColor","textAlign","fontWeight","color","fontSize","appendChild","tick","ticks","undefined","innerText","parseInt","2","url","options","request","XMLHttpRequest","onreadystatechange","this","readyState","status","onSuccess","responseText","onError","open","method","toUpperCase","setRequestHeader","send","data","3","progress_bar","ProgressBar","mc4wp_ecommerce","untracked_order_count","form","getElementById","progressBarMount","updateProgress","new_count","fetchProgress","window","setTimeout","location","reload","ajaxurl","addEventListener","preventDefault","querySelector","setAttribute","work","limit","elements","value","offset","previousCount","textElement","innerHTML","parentNode","response","./_progress-bar.js","./_request.js"],"mappings":"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","file":"admin.min.js","sourcesContent":["(function () { var require = undefined; var define = undefined; (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\nfunction ProgressBar(element, count) {\n  var wrapper = element,\n      bar = document.createElement('div'),\n      step_size = 100 / count,\n      progress = 0;\n  wrapper.style.height = \"40px\";\n  wrapper.style.width = \"100%\";\n  wrapper.style.border = \"1px solid #ccc\";\n  wrapper.style.lineHeight = \"40px\";\n  bar.style.boxSizing = 'border-box';\n  bar.style.backgroundColor = '#cc4444';\n  bar.style.textAlign = 'center';\n  bar.style.fontWeight = 'bold';\n  bar.style.height = \"100%\";\n  bar.style.color = 'white';\n  bar.style.fontSize = '16px';\n  bar.style.width = progress + \"%\";\n  wrapper.appendChild(bar);\n\n  function tick(ticks) {\n    if (done()) {\n      return;\n    }\n\n    ticks = ticks === undefined ? 1 : ticks;\n    progress += step_size * ticks;\n    bar.style.width = progress + \"%\";\n    bar.innerText = parseInt(progress) + \"%\";\n\n    if (done()) {\n      bar.innerText = 'Done!';\n    }\n  }\n\n  function done() {\n    return progress >= 100;\n  }\n\n  return {\n    'tick': tick,\n    'done': done\n  };\n}\n\nmodule.exports = ProgressBar;\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\n\nfunction request(url, options) {\n  var request = new XMLHttpRequest();\n\n  request.onreadystatechange = function () {\n    if (this.readyState === 4) {\n      if (this.status >= 200 && this.status < 400) {\n        options.onSuccess && options.onSuccess(this.responseText);\n      } else {\n        options.onError && options.onError(this.status, this.responseText);\n      }\n    }\n  };\n\n  request.open(options.method || 'GET', url, true);\n\n  if (options.method && options.method.toUpperCase() === 'POST') {\n    request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');\n  }\n\n  request.send(options.data || {});\n  return request;\n}\n\nmodule.exports = request;\n\n},{}],3:[function(require,module,exports){\n'use strict';\n\nvar ProgressBar = require('./_progress-bar.js');\n\nvar request = require('./_request.js');\n\nvar count = mc4wp_ecommerce.untracked_order_count;\nvar form = document.getElementById('add-untracked-orders-form');\nvar progressBarMount = document.getElementById('add-untracked-orders-progress');\nvar progress_bar, progress_poll, worker; // hook into form submit\n\nif (form) {\n  form.addEventListener('submit', start);\n}\n\nfunction start(e) {\n  // prevent default form submit\n  e.preventDefault();\n  var button = form.querySelector('input[type=\"submit\"]');\n  button.setAttribute('disabled', true); // init progress bar\n\n  progress_bar = new ProgressBar(progressBarMount, count);\n  progress_poll = window.setTimeout(fetchProgress, 500);\n  work();\n}\n\nfunction work() {\n  var limit = parseInt(form.elements[\"limit\"].value);\n  var offset = parseInt(form.elements[\"offset\"].value);\n  var url = ajaxurl + \"?action=mc4wp_ecommerce_add_untracked_orders&offset=\" + offset + \"&limit=\" + limit;\n  var previousCount = count;\n  worker = request(url, {\n    onSuccess: function onSuccess(data) {\n      updateProgress(data);\n\n      if (previousCount <= data) {\n        // We're not making progress..\n        var textElement = document.createElement('p');\n        textElement.style.color = 'red';\n        textElement.innerHTML = \"We're stuck. Please <a href=\\\"admin.php?page=mailchimp-for-wp-other\\\">check the debug log</a> for errors.\";\n        progressBarMount.parentNode.appendChild(textElement);\n      } else if (data > 0) {\n        // Keep going if there's more\n        work();\n      }\n    },\n    onError: function onError(code, response) {\n      // if we got a 504 Gateway Timeout, try again.\n      if (code == 504) {\n        work();\n      }\n    }\n  });\n}\n\nfunction updateProgress(new_count) {\n  progress_bar.tick(count - new_count);\n  count = new_count;\n}\n\nfunction fetchProgress() {\n  if (progress_bar.done()) {\n    // refresh page\n    window.setTimeout(function () {\n      window.location.reload();\n    }, 2500);\n    return;\n  }\n\n  var url = ajaxurl + \"?action=mc4wp_ecommerce_get_untracked_orders_count\";\n  request(url, {\n    onSuccess: function onSuccess(data) {\n      updateProgress(data);\n      window.setTimeout(fetchProgress, 2000);\n    }\n  });\n}\n\n},{\"./_progress-bar.js\":1,\"./_request.js\":2}]},{},[3]);\n })();"]}